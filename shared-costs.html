<!DOCTYPE html>
<html lang="">
	<head>
		<meta charset="utf-8">
		<title>Shared Expenses</title>

		<style type="text/css">
			body {
				background: #B7E1CE;
				text-align: center;
				margin: 100px;
			}
			.button {
				margin: 10px;
			}
		</style>
	</head>

	<body>
		<h2>SHARED EXPENSES</h2>
		
		<form action="calculate" method="POST" id="user_inputs">
			<div id="dynamicInput">
				Roommate 1 has already paid: <input type="number" name="Roommate 1">
				Roommate 2 has already paid: <input type="number" name="Roommate 2">
			</div>
			<input class="button" type="button" value="Add another roommate" onClick="addInput();">
		</form>
		
		<input class="button" type="submit" name="submit" value="Calculate" onClick="displayPayments();"/>

		<hr>
		<div id="finalTotals"></div>

        <!-- jQuery, Handlebars -->
		<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.min.js"></script>

		<script type"text/javascript">
			var inputCounter = 2;

			function addInput(){
				var divName = "dynamicInput";
				var limit = 9;

			     if (inputCounter == limit)  {
			          alert("You have reached the limit of adding " + inputCounter + " roommates");
			     }
			     else {
			          var newdiv = document.createElement('div');
			          newdiv.innerHTML = "Roommate " + (inputCounter + 1) + " has already paid: <input type='number' name='Roommate "+ (inputCounter + 1) +"'>";
			          document.getElementById(divName).appendChild(newdiv);
			          inputCounter += 1;
			     }
			}

			function getInputs() {
				// get all inputs into an array
				var $inputs = $('#dynamicInput :input');

				// get an object with key:value as roommate:payment
				var values = {};
				$inputs.each(function() {
				    values[this.name] = $(this).val()/1;
				});

				console.log(values);

				return values;				
			}

			function getAveragePaid(currentPayments) {
				var sum = 0;
				var count = 0;

				$.each(currentPayments, function(key, value) {
					sum += value;
					count += 1;
				});

				console.log("sum/count = " + sum/count);

				return sum/count;
			}

			function getFinalPayments(currentPayments) {
				var averagePaid = getAveragePaid(currentPayments);
				var finalPayments = {};

				$.each(currentPayments, function(key, value) {
					var finalPaymentAmount = averagePaid-currentPayments[key];
					finalPayments[key] = finalPaymentAmount;
				});

				return finalPayments;
			}

			function displayPayments() {
				var currentPayments = getInputs();
				var finalPayments = getFinalPayments(currentPayments);

				$('#finalTotals').empty();

				var finalTotals = "";

				$.each(finalPayments, function(key, value) {
					finalTotals += "<p>" + key + " pays: $" + value + "</p>"; 
				});

				document.getElementById('finalTotals').innerHTML = finalTotals;
			}

		</script>
	</body>
</html>