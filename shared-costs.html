<!DOCTYPE html>
<html lang="">
	<head>
		<meta charset="utf-8">
		<title>Shared Expenses</title>

		<style type="text/css">
			body {
				background: #B7E1CE;
				text-align: center;
				margin: 100px;
			}
			.button {
				margin: 10px;
			}
		</style>
	</head>

	<body>
		<h2>SHARED EXPENSES</h2>

		<div class="entry">
			<form id="user_inputs">
				<div id="dynamicInput">
					<div id="roommate-list"></div>
				</div>
				<input class="button" type="button" value="Add another roommate" onClick="addInput();">
			</form>
			<input class="button" type="submit" name="submit" value="Calculate" onClick="displayPayments();"/>
		</div>

		<div id="finalTotals"></div>
		<hr>

		<script id="roommate-list-template" type="text/x-handlebars-template">
			<div>{{name}} has already paid: <input type="number" name="{{name}}"></div>
		</script>

		<script id="roommate-final-template" type="text/x-handlebars-template">
			<div>{{name}} owes: ${{owes}}</div>
		</script>

        <!-- jQuery, Handlebars -->
		<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.min.js"></script>

		<script>
			// get your template content
			var source = $("#roommate-list-template").html();

			// use Handlebars to "compile" the template
			var template = Handlebars.compile(source);

			// set some data to use in the template
			var roommates = [	{name: "Roommate 1", paid: "", owes: ""},
								{name: "Roommate 2", paid: "", owes: ""}
							];

			$.each(roommates, function(index, roommate) {
				// combine the template with individual roommate to create useable HTML
				var html = template(roommate);

				// append your newly created html
				$('#roommate-list').append(html);
			});

			// ===============================================

			var inputCounter = 2;

			function addInput(){
				var divName = "dynamicInput";
				var limit = 9;

				if (inputCounter == limit)  {
						alert("You have reached the limit of adding " + inputCounter + " roommates");
				}
				else {
					var roommate = {name: "Roommate " + (inputCounter + 1), paid: "", owes: ""};
					// combine the template with individual roommate to create useable HTML
					var html = template(roommate);
					// append your newly created html
					$('#roommate-list').append(html);

					inputCounter += 1;
				}
			}

			function getRoommates() {
				// get all inputs into an array
				var $inputs = $('#dynamicInput :input');

				// makes an array of objects with roommate:payment
				var roommates = [];
				$inputs.each(function() {
					var roommate = {
						name: this.name,
						paid: $(this).val()
					};

					if(roommate.paid !== "") {
						roommates.push(roommate);
					}
				});

				console.log(roommates);

				return roommates;				
			}

			function getAveragePaid(roommates) {
				var sum = 0;
				var count = 0;

				$.each(roommates, function(key, roommate) {
					if(roommate.paid !== "") {
						sum += roommate.paid/1;
						count += 1;
					}
				});

				console.log("sum/count = " + sum/count);

				return sum/count;
			}

			function setFinalPayments(roommates) {
				var averagePaid = getAveragePaid(roommates);

				$.each(roommates, function(key, roommate) {
					roommate.owes = averagePaid-roommate.paid/1;
				});
			}

			function displayPayments() {
				var roommates = getRoommates();
				setFinalPayments(roommates);

				$('#finalTotals').empty();

				var finalTotals = "";

				$.each(roommates, function(key, roommate) {
					finalTotals += "<p>" + roommate.name + " owes: $" + roommate.owes + "</p>"; 
				});

				document.getElementById('finalTotals').innerHTML = finalTotals;
			}

		</script>
	</body>
</html>