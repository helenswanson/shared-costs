<!DOCTYPE html>
<html lang="">
	<head>
		<meta charset="utf-8">
		<title>Shared Expenses</title>

		<style type="text/css">
			body {
				background: #B7E1CE;
				text-align: center;
				margin: 100px;
			}
			.button {
				margin: 10px;
			}
		</style>
	</head>

	<body>
		<h2>SHARED EXPENSES</h2>
		
		<form action="calculate" method="POST" id="user_inputs">
			<div id="dynamicInput">
				<div>Roommate 1 has already paid: <input type="number" name="Roommate 1"></div>
				<div>Roommate 2 has already paid: <input type="number" name="Roommate 2"></div>
			</div>
			<input class="button" type="button" value="Add another roommate" onClick="addInput();">
		</form>

		<input class="button" type="submit" name="submit" value="Calculate" onClick="displayPayments();"/>

		<hr>
		<div id="finalTotals"></div>
		<hr>

		<div id="output-1"></div>
		<hr>
		<!-- <div id="output-2"></div> -->

        <!-- jQuery, Handlebars -->
		<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.min.js"></script>

		<script id="roommates-paid-template" type="text/x-handlebars-template">
			<div class="entry">
				<div>{{name}} has already paid: <input type="number" name="{{name}}"></div>
			</div>
		</script>

<!-- 		<script id="roommates-owe-template" type="text/x-handlebars-template">
			<div class="entry">
				<div>{{name}} owes: $<input type="number" name="{{name}}"></div>
			</div>
		</script> -->

		<script>
			// get your template content
			var roommatesPaidSource = $("#roommate-paid-template").html();
			// var roommatesOweSource = $("#roommate-owe-template").html();

			// use Handlebars to "compile" the template
			var roommatesPaidTemplate = Handlebars.compile(roommatesPaidSource);
			// var roommatesOweTemplate = Handlebars.compile(roommatesOweSource);

			// set some data to use in the template
			var roommates = [	{name: "Roommate 1", "paid": "", "owes": ""},
								{name: "Roommate 2", "paid": "", "owes": ""},
								{name: "Roommate 3", "paid": "", "owes": ""},
								{name: "Roommate 4", "paid": "", "owes": ""},
								{name: "Roommate 5", "paid": "", "owes": ""},
								{name: "Roommate 6", "paid": "", "owes": ""},
								{name: "Roommate 7", "paid": "", "owes": ""},
								{name: "Roommate 8", "paid": "", "owes": ""},
								{name: "Roommate 9", "paid": "", "owes": ""}
							];

			// combine the template with your data to create useable HTML
			var html = template(roommates);

			// append your newly created html
			$('#output-1').append(html);
			// $('#output-2').append(html);
		</script>

		<script type"text/javascript">
			var inputCounter = 2;

			function addInput(){
				var divName = "dynamicInput";
				var limit = 9;

			     if (inputCounter == limit)  {
			          alert("You have reached the limit of adding " + inputCounter + " roommates");
			     }
			     else {
			          var newdiv = document.createElement('div');
			          newdiv.innerHTML = "<div>Roommate " + (inputCounter + 1) + " has already paid: <input type='number' name='Roommate "+ (inputCounter + 1) +"'></div>";
			          document.getElementById(divName).appendChild(newdiv);
			          inputCounter += 1;
			     }
			}

			function getRoommates() {
				// get all inputs into an array
				var $inputs = $('#dynamicInput :input');

				// makes an array of objects with roommate:payment
				var roommates = [];
				$inputs.each(function() {
					var roommate = {
						name: this.name,
						paid: $(this).val()/1
					};

					roommates.push(roommate);
				});

				console.log(roommates);

				return roommates;				
			}

			function getAveragePaid(roommates) {
				var sum = 0;
				var count = 0;

				$.each(roommates, function(key, roommate) {
					sum += roommate.paid;
					count += 1;
				});

				console.log("sum/count = " + sum/count);

				return sum/count;
			}

			function setFinalPayments(roommates) {
				var averagePaid = getAveragePaid(roommates);

				$.each(roommates, function(key, roommate) {
					roommate.owes = averagePaid-roommate.paid;
				});
			}

			function displayPayments() {
				var roommates = getRoommates();
				setFinalPayments(roommates);

				$('#finalTotals').empty();

				var finalTotals = "";

				$.each(roommates, function(key, roommate) {
					finalTotals += "<p>" + roommate.name + " owes: $" + roommate.owes + "</p>"; 
				});

				document.getElementById('finalTotals').innerHTML = finalTotals;
			}

		</script>
	</body>
</html>